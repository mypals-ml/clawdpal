# Instrument: OpenClaw Mac Deployment Plan (Docker)

> **Note**: Docker is optional for OpenClaw. For the fastest Mac setup, use native Node.js: `npm install -g openclaw@latest && openclaw onboard --install-daemon`. See [official getting started](https://docs.openclaw.ai/start/getting-started). Use Docker for isolation/VPS.

## 1. Host Prerequisites (macOS)
Run these services directly on your Mac terminal (not in Docker) to utilize hardware/files easily.

### A. Ollama (AI Backend)
1.  **Install**: Download from [ollama.com](https://ollama.com).
2.  **Model**: Pull a vision-capable model:
    ```bash
    ollama pull llava
    ```
3.  **Serve**: Ensure it accepts external connections.
   - In the Ollama client app, go to settings and set enble "Expose Ollama to the network"
   - Check:
    ```bash
       lsof -iTCP:11434 -sTCP:LISTEN -nP | grep ollama
    ```
    The output should be like:
    ```bash
       ollama   12345 user   14u  IPv4 0x...      0t0  TCP *:11434 (LISTEN)
    ```
   - *Why?* By default, Ollama only listens to `localhost`. Docker containers run in a separate network, so we must bind to `0.0.0.0` to allow the container to reach the host.

## 2. Docker Setup (Official Flow)
Clone repo, build image, onboard.

### Step 1: Clone & Prep
```bash
mkdir ~/openclaw-docker && cd ~/openclaw-docker
git clone https://github.com/openclaw/openclaw.git .
```

### Step 2: Setup Script
- Install Bash
  ```bash
    # 1. Install Homebrew if missing (skip if you have it: `brew --version`)
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    
    # 2. Install modern Bash
    brew install bash
  ```    
- Mounts data:
  ```bash
    mkdir -p ~/clawdpal-data-exchange
    export OPENCLAW_EXTRA_MOUNTS="$HOME/clawdpal-data-exchange:/home/node/clawdpal-data-exchange:rw"
  ```
  - Binds your Mac's ~/clawdpal-data-exchange folder (read-only, :ro) to the container's /home/node/clawdpal-data-exchange path.
    - $HOME/clawdpal-data-exchange: Host path (`~/clawdpal-data-exchange`).
    - /home/node/clawdpal-data-exchange: Container path.
    - **:rw**: For read-write
    - **:ro**: Read-only (agent can't modify host files).
  - After setup, directly read /home/node/clawdpal-data-exchange/test.jpg if configured in tools.
- Run Setup and sets Ollama
  - **Run Docker App**: On macOS, Docker runs via Docker Desktop (not CLI daemon like Linux).
  - **Run setup file**
    ```bash
      cd openclaw
      $(brew --prefix)/bin/bash ./docker-setup.sh
    ```
    - It will:
      - Builds image, runs wizard (pick Ollama/llava)
      - the data volume will be auto-mounted to after the next step: `~/.openclaw/`
      - After setup, the agent can directly read /home/node/clawdpal-data-exchange/test. 
    - **Wizard Config Telegram**:
      - **Select channel (QuickStart)**: 
        │  ● Telegram (Bot API) (not configured)
            1. Open Telegram app/web → Search and message @BotFather (official Telegram bot creator).
            2. Send /newbot → Follow prompts:
                - Bot name (e.g., "MyClawdpalBot") – must be unique.
                - Username (e.g., @MyClawdpalBot) – must end with "Bot" and be unique.
            3. Copy the API Token (e.g., 123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11). This is secret—don't share it.
## 3. Model & Channel Config
**Wizard sets Ollama**: Base `http://host.docker.internal:11434`, model `llava`.
## 4. Telegram Config
1. Open Telegram app/web → Search and message @BotFather (official Telegram bot creator).
2. Send /newbot → Follow prompts:
   - Bot name (e.g., "MyOpenClawBot") – must be unique.
   - Username (e.g., @MyOpenClawBot) – must end with "Bot" and be unique.
3. Copy the API Token (e.g., 123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11). This is secret—don't share it.
4. Run in terminal:
   ```bash
   docker compose run --rm openclaw-cli channels add --channel telegram --token "TOKEN"
   ```
   - This will not cause the Docker instances to restart automatically.
     - It runs a one-off container (--rm removes it after), updates the config files in the mounted ~/.openclaw/ directory, and exits. 
   - The running openclaw-gateway container continues without interruption. 
   - However, changes like adding channels may not take effect immediately (the gateway caches config). 
   - Check logs after:
     ```bash
     docker compose logs openclaw-gateway
     ```
    – Look for "Telegram Polling Started". If not, restart. Official docs confirm restarts are sometimes needed for config changes:
      - To restart it: 
      ```bash
      docker compose restart openclaw-gateway
      ```
      - Or stop/start: 
      ```bash
      docker compose down && docker compose up -d.
      ```

## 4. Accessing the Control UI
After running ./docker-setup.sh and starting containers, use the Control UI (web dashboard) to manage OpenClaw (e.g., view config, logs, channels). It's served by the openclaw-gateway container at http://localhost:18789/.
1. **Get the UI Token**:
   ```bash
   cd ~/openclaw-docker
   docker compose run --rm openclaw-cli dashboard --no-open
   ```
   - **What It Does**:
     - Runs a one-off openclaw-cli container (--rm removes after).
     - Generates a secure token/URL for the dashboard (printed in terminal).
     - **--no-open** : Doesn't auto-open browser (useful in headless/Docker).
   - **Output Example**: "Dashboard URL: http://localhost:18789/?token=abc123...". Copy the token or full URL.
2. **Access the UI**: 
   - `http://localhost:18789/`
   - Paste token
   - Click "Connect"
3. **Check Dashboard Features**
   - Settings: Verify config (e.g., Ollama model llava, base URL http://host.docker.internal:11434).
   - Channels: Check Telegram (shows connected, DM policy).
   - Agents/Sessions: View active chats/history.
   - Logs: Real-time gateway logs.
   - Tools: Manage enabled tools.
4. **Logs**: `docker compose logs -f openclaw-gateway` (Gateway start/channels).

## 5. Vision Test
- Telegram: `@MyClawdpalBot` → Start.
- Msg: 
  - `Look at http://host.docker.internal:8000/test.jpg and describe.`
  -  "Describe the image at /home/node/clawdpal-data-exchange/test.jpg"
  **Success**: UI loads, bot responds, describes image.

## Appendix A: Switch Providers
`docker compose up -d` after.

1. Anthropic: `docker compose run --rm openclaw-cli models add anthropic claude-3-5-sonnet-20240620 --key sk-ant-...`
2. Google: `... models add google gemini-1.5-pro --key AIza...`
3. xAI: `... models add openai grok-beta --base-url https://api.x.ai/v1 --key xai-...`

[Models docs](https://docs.openclaw.ai/concepts/models).

## Appendix B: Chat Commands (Telegram)
`/status`, `/new`/`/reset`, `/compact`, `/think off|low|medium|high`, `/usage off|tokens|full`, `/verbose on|off`, `/restart`, `/activation mention|always`.

## Appendix C: Key Concepts

### Why `OLLAMA_HOST=0.0.0.0`?
By default, Ollama is "shy"—it only listens to `localhost` (127.0.0.1). This means only programs running directly on your Mac can talk to it.
*   **Without `0.0.0.0`**: Docker tries to connect, but Ollama ignores it because the request isn't coming from `localhost`.
*   **With `0.0.0.0`**: You tell Ollama to listen to **all** network interfaces. It allows the Docker container (via the `host.docker.internal` bridge) to reach the Ollama API.

### Data Persistence
`~/.openclaw/` mounted (sessions/workspace). Restart safe.

### Explanation: "If Configured in Tools"
In OpenClaw, tools are built-in capabilities (e.g., file reading, web browsing, code execution) that the agent uses to perform actions. The phrase means the agent can only access /home/node/clawdpal-data-exchange/test.jpg if its tools (specifically, file-access tools) are enabled and configured to allow it.

#### Key Points
- **Default Tools**: OpenClaw comes with tools like read (reads files), write (edits files), and others. By default, file tools are enabled, so the agent can access mounted paths like /home/node/clawdpal-data-exchange/test.jpg without extra setup.
- **Configuration**: Tools are controlled in ~/.openclaw/config/ (e.g., tools.json). You can enable/disable/deny tools per agent or globally. For example:
  - Allowed by default: read, write, edit.
  - If denied (e.g., for security), the agent can't access files.
- **In This Context**: With mounts, the path is accessible—command the agent (e.g., "Read /home/node/clawdpal-data-exchange/test.jpg"), and it uses read tool automatically. "If configured" means if tools are set up (they are by default in Docker/native installs).
